

/// the ingress acts as a advance version of both the
    NODEPORT AND LOADBALANCING

Without Ingress, you expose services like this:
Service A ‚Üí NodePort 30001
Service B ‚Üí NodePort 30002
Service C ‚Üí NodePort 30003

‚ùå Problems:
Random ports
No domain names
No HTTPS
Hard to manage

***Definition:-
Ingress is an HTTP/HTTPS entry point to your Kubernetes cluster

***Ingress Architecture:-(Important)
the ingress has two main components
1) Ingress Controller(Actual Engine) NGINX, Traefik, HAProxy
2) Ingress Resource (Rules) YAML file, Defines routing rules
Internet
   |
Ingress Controller (NGINX)
   |
Ingress Rules
   |
Service
   |
Pods


/// IMPLEMENTATION OF INGRESS IN KUBERNETES CLUSTER:-

Step 1: Enable Ingress through minikube

        minikube addons enable ingress


Step 2: Verify the Controller

        kubectl get pods -n ingress-nginx

Step 3: as of now we have two services with ClusterIP configured
        in both the order and product service yaml
        spec:
          type: ClusterIP
          selector:
            app: order
          ports:
            - port: 80
              targetPort: 8080

Step 4:
        create a Ingress.yaml inside the folder k8s/

        apiVersion: networking.k8s.io/v1
        kind: Ingress
        metadata:
          name: app-ingress
          annotations:
            nginx.ingress.kubernetes.io/rewrite-target: /
        spec:
          ingressClassName: nginx
          rules:
            - host: myapp.local
              http:
                paths:
                  - path: /orders
                    pathType: Prefix
                    backend:
                      service:
                        name: order-service
                        port:
                          number: 80
                  - path: /products
                    pathType: Prefix
                    backend:
                      service:
                        name: product-service
                        port:
                          number: 80

        and then we have to run these commands

                kubectl apply -f .\Ingress.yaml (for applying it into minikube)

            for getting the ingress IP

                PS D:\SpringFiles\SpringCloud&Kubernetes\k8s> kubectl get ingress
                NAME          CLASS   HOSTS         ADDRESS        PORTS   AGE
                app-ingress   nginx   myapp.local   192.168.49.2   80      2m37s

Step 5:  Very Important Step

        1Ô∏è‚É£1Ô∏è‚É£ Map Domain to IP (Very Important)

        Ingress uses domain names, so update your hosts file.

        Windows
        C:\Windows\System32\drivers\etc\hosts (save this file with properties ->permission to Users)

        Add:
        192.168.49.2   myapp.local

Step 6: Testing the Ingress with the url

            before testing we have to ensure (MOSTTTTTT IMPORTANT)
                    minikube tunnel
                    minikube service ingress-nginx-controller -n ingress-nginx

                    THERE IS AN EXCEPTION FOR CALLS WE CAN USE THE
                    http://myapp.local:port/orders
                    this port is the above port ............

            WITHOUT THIS COMMAND WE CANT ACTIVATE THE LOADBALANCING OR INGRESS FOR MINIKUBE CLUSTER

            http://myapp.local/orders and http://myapp.local/products

    test this from the browser or postman call you can able to see the results...


////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////


1Ô∏è‚É£ Absolute First Check (MOST COMMON ISSUE)

Run:
        minikube addons list | findstr ingress

Expected:
ingress                   enabled
ingress-dns               disabled

If ingress is disabled, enable it:
        minikube addons enable ingress


2Ô∏è‚É£ Verify Ingress Controller Is ACTUALLY RUNNING

Run:
        kubectl get pods -n ingress-nginx

You MUST see:
ingress-nginx-controller-xxxxx   Running


üí° This is the #1 missed step
4Ô∏è‚É£ Test Again (After Tunnel) // minikube tunnel
Now try:
http://myapp.local/orders

If still not working ‚Üí continue below.

5Ô∏è‚É£ Confirm Ingress Is Correctly Bound

Run:
        kubectl describe ingress


You should see:
Rules:
  Host        Path     Backends
  ----        ----     --------
  myapp.local /orders  order-service:80
  myapp.local /products product-service:80
‚ùå If BACKENDS are <none> ‚Üí service name/port mismatch

6Ô∏è‚É£ Verify Services (VERY IMPORTANT)

Run:
        kubectl get svc

Expected:
order-service     ClusterIP   10.x.x.x   <none>   80/TCP
product-service   ClusterIP   10.x.x.x   <none>   80/TCP

Now:
        kubectl describe svc order-service
Check:
TargetPort: 8080
Endpoints: 10.244.x.x:8080
‚ùå If Endpoints is EMPTY ‚Üí Pods not matching labels
7Ô∏è‚É£ Verify Pods & Labels (Common Mistake)

Run:
        kubectl get pods --show-labels
Make sure:
Pods have app=order
Services select app=order
If labels don‚Äôt match ‚Üí traffic has nowhere to go.

8Ô∏è‚É£ Check Ingress Controller Logs (THIS WILL TELL THE TRUTH)
Run:
        kubectl logs -n ingress-nginx deployment/ingress-nginx-controller
Look for:
no endpoints available
service not found
connection refused
This log is gold.



